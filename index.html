<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2196F3">
    <title>RÃ©expÃ©ditions Facteur</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Ã‰cran d'accueil -->
    <div id="home-screen" class="screen active">
        <header>
            <h1>ğŸ“¬ RÃ©expÃ©ditions</h1>
            <div class="stats">
                <span id="total-count">0</span> actives
                <span class="separator">â€¢</span>
                <span id="expiring-count">0</span> bientÃ´t expirÃ©es
            </div>
        </header>

        <div class="main-actions">
            <button class="action-btn primary" onclick="ui.showScreen('scan-register')">
                ğŸ“· Scanner un carton
            </button>
            <button class="action-btn secondary" onclick="ui.showScreen('scan-check')">
                ğŸ” VÃ©rifier un colis
            </button>
            <button class="action-btn tertiary" onclick="ui.showScreen('list')">
                ğŸ“‹ Liste complÃ¨te
            </button>
        </div>

        <div class="quick-actions">
            <button class="small-btn" onclick="database.cleanExpired()">
                ğŸ—‘ï¸ Nettoyer expirÃ©es
            </button>
            <button class="small-btn" onclick="ui.showExpiringList()">
                âš ï¸ Expiration proche
            </button>
        </div>
    </div>

    <!-- Ã‰cran scan enregistrement -->
    <div id="scan-register-screen" class="screen">
        <header>
            <button class="back-btn" onclick="ui.showScreen('home')">â† Retour</button>
            <h2>Scanner un carton</h2>
        </header>

        <div class="camera-container">
            <video id="video-register" autoplay playsinline></video>
            <canvas id="canvas-register" style="display:none;"></canvas>
        </div>

        <div class="scan-actions">
            <button class="action-btn primary" onclick="scanner.captureAndProcess('register')">
                ğŸ“¸ Capturer
            </button>
            <button class="action-btn secondary" onclick="ui.toggleManualForm()">
                âœï¸ Saisie manuelle
            </button>
        </div>

        <div id="ocr-result-register" class="ocr-result"></div>

        <!-- Formulaire de saisie manuelle -->
        <div id="manual-form" class="ocr-result" style="display:none;">
            <div class="result-card">
                <h3>âœï¸ Saisie manuelle</h3>
                <form id="reexp-form" onsubmit="scanner.saveManual(event)">
                    <div style="margin-bottom:15px;">
                        <label style="display:block; margin-bottom:5px; font-weight:600;">Type *</label>
                        <select id="form-type" required style="width:100%; padding:10px; border:2px solid #ddd; border-radius:8px; font-size:16px;">
                            <option value="">-- Choisir --</option>
                            <option value="TEMPORAIRE">ğŸ”´ TEMPORAIRE</option>
                            <option value="DÃ‰FINITIVE">ğŸŸ¢ DÃ‰FINITIVE</option>
                        </select>
                    </div>

                    <div style="margin-bottom:15px;">
                        <label style="display:block; margin-bottom:5px; font-weight:600;">Nom du destinataire *</label>
                        <input type="text" id="form-nom" required placeholder="Ex: DUPONT JEAN" style="width:100%; padding:10px; border:2px solid #ddd; border-radius:8px; font-size:16px;">
                    </div>

                    <div style="margin-bottom:15px;">
                        <label style="display:block; margin-bottom:5px; font-weight:600;">Ancienne adresse *</label>
                        <textarea id="form-ancienne" required placeholder="Ex: 14 RUE JULES LABAT, 64100 BAYONNE" rows="3" style="width:100%; padding:10px; border:2px solid #ddd; border-radius:8px; font-size:16px; font-family:inherit; resize:vertical;"></textarea>
                    </div>

                    <div style="margin-bottom:15px;">
                        <label style="display:block; margin-bottom:5px; font-weight:600;">Nouvelle adresse *</label>
                        <textarea id="form-nouvelle" required placeholder="Ex: 7 ALLEE SAINT EXUPERY, 64600 ANGLET" rows="3" style="width:100%; padding:10px; border:2px solid #ddd; border-radius:8px; font-size:16px; font-family:inherit; resize:vertical;"></textarea>
                    </div>

                    <div style="margin-bottom:15px; display:flex; gap:10px;">
                        <div style="flex:1;">
                            <label style="display:block; margin-bottom:5px; font-weight:600;">Date dÃ©but *</label>
                            <input type="date" id="form-debut" required style="width:100%; padding:10px; border:2px solid #ddd; border-radius:8px; font-size:16px;">
                        </div>
                        <div style="flex:1;">
                            <label style="display:block; margin-bottom:5px; font-weight:600;">Date fin *</label>
                            <input type="date" id="form-fin" required style="width:100%; padding:10px; border:2px solid #ddd; border-radius:8px; font-size:16px;">
                        </div>
                    </div>

                    <div style="display:flex; gap:10px;">
                        <button type="submit" class="action-btn primary" style="flex:1;">
                            ğŸ’¾ Enregistrer
                        </button>
                        <button type="button" class="action-btn secondary" onclick="ui.toggleManualForm()" style="flex:1;">
                            âŒ Annuler
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ã‰cran scan vÃ©rification -->
    <div id="scan-check-screen" class="screen">
        <header>
            <button class="back-btn" onclick="ui.showScreen('home')">â† Retour</button>
            <h2>VÃ©rifier un colis</h2>
        </header>

        <div class="search-manual">
            <input type="text" id="manual-search" placeholder="ou tapez un nom...">
            <button onclick="search.manualSearch()">ğŸ”</button>
        </div>

        <div class="camera-container">
            <video id="video-check" autoplay playsinline></video>
            <canvas id="canvas-check" style="display:none;"></canvas>
        </div>

        <div class="scan-actions">
            <button class="action-btn primary" onclick="scanner.captureAndProcess('check')">
                ğŸ“¸ Scanner le nom
            </button>
            <button class="action-btn secondary" onclick="scanner.stopCamera('check')">
                âŒ Annuler
            </button>
        </div>

        <div id="search-result" class="search-result"></div>
    </div>

    <!-- Ã‰cran liste -->
    <div id="list-screen" class="screen">
        <header>
            <button class="back-btn" onclick="ui.showScreen('home')">â† Retour</button>
            <h2>Liste des rÃ©expÃ©ditions</h2>
        </header>

        <div class="filters">
            <button class="filter-btn active" onclick="ui.filterList('all')">Toutes</button>
            <button class="filter-btn" onclick="ui.filterList('TEMPORAIRE')">ğŸ”´ Temporaires</button>
            <button class="filter-btn" onclick="ui.filterList('DÃ‰FINITIVE')">ğŸŸ¢ DÃ©finitives</button>
        </div>

        <div id="reexp-list" class="reexp-list"></div>
    </div>

    <!-- Loading overlay -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Analyse en cours...</p>
    </div>

    <!-- Scripts -->
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js'></script>
    <script src="js/database.js"></script>
    <script src="js/parser.js"></script>
    <script src="js/scanner.js"></script>
    <script src="js/search.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
